\newpage

\begin{CJK*}{GBK}{song}

\setcounter{chapter}{2}
\setcounter{section}{0}

\chapter{实时交易时代}

\thispagestyle{empty}
\markboth{实时交易时代}{实时交易时代}
在线广告发展到竞价阶段，可以说基本的计算格局已经建立，大多数重要的计算问题，也都浮出水面并得到研究。然而，随着需求方进一步优化流量的目标进一步加强，广告网络在产品形态上已经无法完全满足需要。市场的发展方向，是向需求方进一步开放。具体地说，除了允许广告主按照已经定义好的用户划分来购买，进一步提供广告主自行选择流量和在每次展示上独立定价的功能。这样的功能，必然要求竞价这一过程在每次展示时实时进行，也就是实时竞价(Real Time Bidding, RTB)。

RTB的产生，使得广告市场向着透明的比价平台的方向发展，这样的平台就是广告交易平台(Ad Exchange)，其主要特征即是用RTB的方式实时得到广告候选，并按照其出价简单完成投放决策。与广告交易平台对应的采买方，我们称为需求方平台(Demand Side Platform, DSP)。在这样的交易市场中，需求方对于流量的选择和控制能力达到了极致，因此其技术和算法的挑战也相当大；而供给方的变成了简单的比较平台，因此结构上相对清晰简单。由于实时竞价的功能需求，广告交易市场解决供给方和需求方用户身份对应的问题，这需要用到cookie-mapping的技术。

虽然供给方在广告交易中遇到的算法问题不多，但还是要解决好带宽资源的限制下，用更少的询价请求完成尽可能高效的变现这一问题。从优化角度来看，这很像前面的在线分配问题，同样的带约束优化思路也仍然可以适用。

从需求方来看，定制化的用户划分能力使得广告主可以象优化自己的推荐系统那样优化广告购买，唯一的区别是这个推荐系统是放在站外的。出价需求的存在和广告主预算范围内的套利，要求DSP具备点击率预测、点击价值估计、流量预测、站外推荐等多方面的运算能力。除了站外推荐，广告市场新的发展趋势是根据广告主提供的种子用户，利用海量的媒体数据为广告主找到行为相似的潜在用户。这样的一些定向方式，都是针对$(a,u)$组合的定制化用户划分，它们使得在线广告的受众定向精准程度达到了前所未有的水平。

在需求方的利益得到了充分的保证以后，媒体的变现手段也发生了相应的变化。到现在为止，媒体至少有四中常用的广告变现选择：担保式投送的合约售卖方式、自营广告网络、托管给其他广告网络、通过RTB变现。如果动态地选择这四种模式中变现价值最高的那种，以最大化媒体收益，这是供给方面临的市场需求。在这样的需求驱动下，产生了供给方平台这样的完全优化媒体利益的产品。

当在线广告市场进入到这个阶段以后，程序交易(Programmatic Trade)的方式已经成为举足轻重的力量，它使得整个在线广告市场越来越向着数据驱动、计算导向的方式前进。我们在本章中也对程序购买的若干种主要方式，以及对应的供应方和需求方产品做了一下小结，并与合约导向的优先销售方式做了对比。准确理解每一种交易方式的特点、长处和适用场景，无论是对于供给方更好地变现流量，还是需求方更准确有效地投送广告，都有相当重要的意义。
\section{实时竞价的广告交易平台}

关于广告交易平台，即Ad Exchange产生的原因，市场上存在着不同的解释。最早的Ad Exchange产品RightMedia的初衷，是在纽约的一些广告代理公司之间交换剩余流量。因此，最初的Ad Exchange也并不是采用RTB的交易方式。但是非实时竞价的方式并不能从根本上满足流量交换的需求，因为剩余流量只有按照需求方最精确的定向方式来交换，才能获得最高的价值。所以当RTB产生以后，迅速成为Ad Exchange的标配甚至最主要的功能。

\subsection{广告交易平台架构}
\subsection{代表案例介绍:rightmedia, Google adx}
Ad Exchange从历史发展来看，有两种侧重点不同的产品方向。一种是早期的Rightmedia模式，主要产品目标是在一些代理商之间交换流量，因而是一个只有在交易双方有协议约定的情形下才可以竞价采买市场；另外一种是DoubleClick的模式，它提供的是一个完全透明，理论上任何DSP都可以对任何流量竞价的公开交易市场。对于这两家具有代表性的Ad Exchange，我们在下面做对比性的介绍。

\subsubsection{Rightmedia}

Rightmedia成立于×年，后被Yahoo!所收购。

\subsubsection{Doubleclick Adx}

Google在收购了DoubleClick以后，于*年推出了基于实时竞价的Ad Exchange，称为DoubleClick Adx。
\section{需求方平台(DSP)}
对Ad Exchange相对应，以RTB方式购买广告的产品形态就是需求方平台(DSP)。这一产品的核心特征有两个：一个当然是支持RTB方式的流量购买，另一个是需要支持定制化的用户划分。大家需要仔细体会，这两个核心特征其实是同一问题的两个方面：为了能够按定制化的用户划分采买广告，需要市场开放竞价接口；而如果按照供给方定义的用户划分来采买，那么像广告网络那样的非实时竞价就基本可以满足了。

那么什么是定制化的用户划分呢？从受众定向的角度看，那些形如$f(a, u)$的定向方式，即广告主相关的定向方式，就是定制化用户划分。举两个例子来直观地理解一下：第一个例子，假设某电商网站准备进行一次面向其老客户的广告投放，这里的“老客户”就是一种定制化用户划分，显然只有该电商自己才能找到这个用户群，而任何媒体或广告网络，无论数据能力有多强，也无法加工出这样的标签。第二个例子，某银行希望通过广告接触到自己信用卡的潜在客户。要找到这些潜在客户，我们需要以银行现有的客户作基础，分析其行为和人口属性有哪些特征，然后再根据这些特征去拓展可能的潜在客户。这一过程既需要需求方的数据，又需要媒体数据，而其加工出的人群仍然是与广告主相关的，因此也属于定制化用户划分。

DSP与其它广告产品的相比，多了定制化用户划分功能，即图中的Customized Audience Segmentation部分。这部分通常的方式是在广告主网站上布DSP域名的代码，收集到用户行为并进行离线加工分析，再将加工出的标签用于广告投放。由于可以细分到每个展示的粒度来决策和出价，这使得需求方可以向一个推荐系统那样精细化执行广告活动，也使得推荐和广告这两向互联网重要的技术找到了完美的切合点。下面我们从两种常用的定制化用户标签入手，深入看一下广告和推荐的关系。

\subsection{重定向}

重定向(Retargeting)是广告中最早产生，也最广泛使用的一种定制化标签。重定向的概念很简单，即把那些曾经对广告主服务发生明确兴趣的用户找出来，再次向他们投放该广告主的广告。在不同的广告类型上，重定向主要有两种的目的：

一、用于品牌广告。当用户已经选择过某品牌的服务或产品后，如果在比较高质量的媒体上看到该品牌的广告，他会进一步肯定自己决策的正确性，从而对该品牌的认知度也大大加强。这种用途下，应当以宣传品牌而不是具体产品为主要诉求。

二、用于效果广告。当用户曾经考虑过某种产品，但没有完成最终转化，通过在线广告将他找回，点击率和转化率都会明显高于平均水平。如果用户已经选择了该产品，那么可以利用推荐技术为他推送相关的产品广告。

我们可以看出，在这两种用途中，重定向都绝不仅仅是你浏览过什么产品，就再给你推送该产品的广告创意这么简单。重定向可以从信息来源和使用信息的精细程度上区分为下面三种类型：

一、网站重定向(Site Retargeting)，即将在一段时间内到达过广告主网站的用户群作为重定向集合。这样的重定向流量其eCPM一般来说要比无定向流量高出一个数量级，因此需要尽可能扩大投放量。在媒体上采买这种重定向流量时，能够得到的量有两个主要影响因素，一是广告主网站本身的独立访客量水平，二是这些访客与媒体的重合程度。前一个因素没有办法通过广告手段扩大，而后一个因素则要求尽可能多地通过各种渠道采买重定向流量。

要进行网站重定向，需要一个接口将访问广告主网站的用户集合传送给DSP，即架构图中的Customized Audience Segmentation部分。这个接口也有两种主流的实现方式：第一种是直接在广告主的网站上布设DSP域名的JS代码或者外链图片(也可以是不可见的beacon)，这样DSP就可以直接收集到访客的记录，再自行加工分析即可；第二种方式，是用线下数据接口的方式，定期将广告主或者其委托的DMP收集到的访客集合批处理式地传送给DSP。当然，前提是DSP与广告主或其DMP之间建立起了cookie-mapping的机制。这两种方式各有各的优缺点：前者能够实时地获取访客信息，但是需要一段时间的数据积累才能覆盖广告主用户集合的大部分，而且在多个DSP同时服务于一家广告主时需要加多段跟踪代码，有降低页面响应速度的风险；后者虽然可以迅速得到访客集合，并且避免了页面因多组跟踪代码而变得太重，却在数据更新时有一定的延迟，并且对广告主方的技术要求较高(跟DMP对接时例外)。

二、个性化重定向(Personalized Retargeting)。对重定向流量进行深入加工，按照品类和购买阶段等因素进行创意上的深度个性化，就是个性化重定向。具体来说，个性化重定向可以在两个方面做深入挖掘：一是对于处于不同购买阶段的用户，采用合适的创意推动他尽快完成转化行为，这里的购买阶段，包括浏览、搜索、加入购物车等；二是对于已经有过一些购买记录的用户，使用推荐技术向其展示相关的商品以提升二次购买率。从这两层意义上看，这一方法与推荐有非常多的共通之处：以广告产品的视角看，我们称之为个性化重定向；而从推荐产品的视角看，则可以认为是一种站外推荐(Off-site Recommendation)，换句话说，是将原来广告主网站上的推荐模块搬到了站外。

三、搜索重定向(Search Retargeting)，即将搜索过跟广告主直接相关的关键词的用户群作为重定向集合。这样的方式也可以获得很精准的用户群，其绝对量也要高于网站重定向，不过对于非主要搜索引擎提供上来说，依靠搜索重定向能覆盖的人群比例未必会高于网站重定向。

在以上重定向方式中，简单的网站重定向和搜索重定向实现起来都比较直接，我们重点来讨论一下个性化重定向需要的技术方案。

\subsubsection{个性化重定向}

个性化重定向与传统的受众定向方式有比较大的技术差别，虽然这些差异化的技术都不算困难。其核心支持技术，主要有以下几个关键：

一、动态创意。个性化重定向的核心，是在某个用户到来时，实时决定给他展示什么商品，以及用什么方式展示。由于广告主的商品数量往往相当大，因此显然不可能为所有的商品预先准备好创意，而如果考虑到同时推荐若干商品的组合关系，就更加不能采用静态的创意方式。因此，动态创意技术，是个性化重定向最重要的支持技术。这是在线广告朝着彻底个性化、动态化方向发展迈出的重要一步。

二、推荐技术。由于可以把个性化重定向因而看作是站外推荐，显然推荐技术也是必要的。不过与站内推荐相比，这样的推荐还是有一些不同之处：首先站内商品页上的推荐主要根据上下文信息来进行，而站外推荐则是根据用户信息来进行；另外，站内推荐由于是发生在某个特定的购买环节上的，因而往往不需要根据用户的购买阶段来调整创意，而站外推荐这么做则有非常大的必要。

三、广告主商品库存实时接口。对于站外的商品推荐，如果用户在点击某单品到达广告主网站时，发现该商品已经售完或下架，或者是价格与创意上的宣传不符，会对该广告主的品牌形象有较严重的伤害。为了尽可能避免这种情况的发生，个性化重定向的技术提供者往往需要统一提供一个准实时的商品库接口，使得广告主可以比较简单地将自己的库存和价格信息及时地同步过来。

\begin{figure}\label{fig_personal}
\centering
\scalebox{0.65}
{
    \includegraphics[width=1.5\textwidth]{personal.eps}
}
\caption{个性化重定向广告示例}
\end{figure}

在图\ref{fig_personal}中，我们给出了个性化重定向广告的一个示例。该广告投放的对象，是某个京东商城的用户。该用户很可能在京东商城关注过某种手机商品，以及有关PHP编成的技术书籍。因此，广告系统根据他的个性化购物兴趣，结合京东商城的商品库存，为其推荐了相关的手机和技术书籍。可以想见，这样的广告其点击率和转化率都会比较高。

\subsubsection{搜索重定向}

\subsection{新客推荐(Look-alike)}

重定向的方式虽然精准，但是量受到极大的限制，而且与广告希望接触某种类型潜在人群的目的也有距离。对于很多广告主来说，除了已经对自己的产品发生明确兴趣的用户，他们更希望能有系统性的手段接触到那些“很有可能”对自己产品发生兴趣的用户。对于那些快速成长期的电商、或者是网站流量并不大的线下业务广告商(比如银行、汽车)，这方面的需求尤其强烈。“很有可能对自己产品发生兴趣的用户”这样的用户划分，从目的上来说很明确，但从做法上来说很模糊。基本的思路是这样：由广告主提供一部分种子用户，再由拥有更丰富数据的广告平台分析这些用户网络行为的特征，并根据这些特征找到具有相似特征的拓展人群。很显然，这也是一种定制化用户标签，即$f(a, u)$的定向方式。

从推荐的角度来看Look-alike，可以认为这是一种“新客推荐”的方式，即向原来没有关注广告主产品的潜在用户推广该广告主产品。当然既然是推荐，就不是漫无目的的撒网式推广，而这样的推荐技术，考虑的是没有站内行为情况下的推荐，是原有狭义推荐问题的扩展，也是广告本质目的与推荐需求的重要切合点。

关于Look-alike的具体建模方法，目前市场上还没有大家公认的通用方案。不过，如果我们从这种定向方式的本质，即$t(a,u)$的特点出发，并且以优化效果为主要目的的话，也可以对前文讨论的点击率预测模型做一些变化，得到一种Look-alike的可行方法。

前文讨论的点击率模型，目的是任意给定一组$(a,u,c)$的组合，按照一个预先训练好的模型对其点击率进行预估。如果我们变换一下思路，只用某一个广告主的投放数据，训练一个$(a,u)$组合相关特征的点击率模型$p(h=1|a,u)$，那么这个模型描述就是一个专门对与该广告主，不同用户的点击率水平的评估函数。由于此模型与$c$无关，因此同一个用户的不同展示可能出现有时为正例、有时为负例。如果对这一模型再做一点加工，将所有在训练集中出现过的曾经访问过该广告主网站的用户，其对应样本都置为正样本，那我们得到的就是一个评价该用户是否有可能成为该广告主访客的函数了。

\subsection{代表案例介绍}
定制化用户划分和RTB技术的产生，催生了大量以技术方式优化广告采买的DSP公司。这些公司当中，有些以CPM采买，并优化ROI的套利模式为主；有的则以透明的采买和效果优化功能性服务为主，我们将对这两种类型的DSP分别举例说明。

\subsubsection{Criteo}

Criteo是专注于个性化重定向产品的一家总部位于法国的广告技术公司。需要首先说明的是，Criteo从其历史业务来看，并非我们认为的严格意义上的DSP，这主要是由于它主要的流量才买方式，并不是实际竞价，而是一种被称为优选(Preferred Math)的交易方式，我们先来看一下这种交易的过程。

\begin{figure}\label{fig_prefer}
\centering
\scalebox{0.6}
{
    \includegraphics[width=1.3\textwidth]{Preferred.eps}
}
\caption{优选购买方式过程示意}
\end{figure}

优选过程的示意如图\ref{fig_prefer}所示，其关键是允许某个需求方按照自己的意愿来挑选流量，但是又可以避免复杂的cookie-mapping和竞价过程。这个过程主要有以下几个步骤：1. 用户浏览媒体网站；2. 媒体网站JS代码向媒体的广告服务器发起请求；3. 媒体广告服务器向需求方的广告服务器发起请求，询问是否需要此次广告展示机会；4. 需求方广告服务器根据自己的逻辑判断，如果需要此次展示机会，则返回相应的广告创意；5. 需求方如果不需要此次展示机会，则通知媒体广告服务器，由媒体广告服务器在从自有广告库中选择合适的创意返回。

优选过程使得需求方可以比较自由地挑选流量，同时也要付出较高的CPM成本。与前面的RTB过程相比较，优选过程也可以从概念上理解为一个只有唯一参与者的RTB过程。优选过程的一个缺点，是决策过程可能存在比较多的服务器往返：在极端情况下，需要三次服务器的往返才能够得到最后的广告。这有可能使得用户看到的广告延迟增大，从而影响广告效果。这一过程中的第3 个步骤有可能存在更复杂的逻辑，即媒体方可以根据实现与需求方的一些信息对接，初步判断某些展示机会是需求方肯定不需要的，这样的情况下，就不再向需求方广告服务器发起请求，从而减少这部分流量的服务器往返次数。

Criteo不同于其他的需求方技术公司，基本上只按照个性化重定向方式采买广告。其核心技术也就是前面介绍的三项。下图中给出了Criteo个性化重定向创意的几个例子。Criteo按照前面介绍的优选方式，以CPM方式与媒体结算，但是与广告主之间的结算完全采用CPC方式，从而实现套利，并且也比较容易被效果类广告主接受。在个性化重定向的方案框架内，Criteo 还提供了User、Category、Data 和Banner 四个维度上比较灵活的优化功能，即广告主可以根据不同的用户细分、商品种类、具体数据和创意类型设置不同的点击出价，从而达到非常精细的ROI管理和优化的目的。这样的显示广告运营和投送方式，其精细程度与搜索广告有相似之处：都是在非常精准的流量细分上以效果为导向投放广告，并且能够在非常精细的粒度上控制出价。不过这种方式对与显示广告来说有一些先天的缺点：个性化重定向不同于搜索广告，需要预先在广告主网站布设跟踪代码，这使得新广告主加入的进程变得大为复杂。因此，专门从事个性化重定向的公司，在初期会面临需求不足的问题，并且需要运营商大量的努力和效果上良好的记录才能逐步改善，而Criteo也同样经历了这一过程。

\subsubsection{InviteMedia}

InviteMedia原是一家独立的DSP公司，后背Google收购，现已整合进DoubleClick的广告系列产品，并改名为DoubleClick Bid Manager。

InviteMedia是广告交易市场上的先行者之一。

\section{供给方平台(SSP)}
现在我们可以来看看在程序交易的环境下，供给方的综合性技术方案了。对于媒体而言，无需把全部流量的变现都押在一种交易方式上：既可以通过直接销售来高溢价地售卖品牌广告，也可以灵活地综合使用各种程序交易方式以追求更高的eCPM。参照上一节中的广告交易方式谱系，媒体的统一变现平台需要这样的逻辑：当广告请求到达时，首先检查优质销售方式有无需求，包括CPT和GD的合约，如有需求，按照优先级即在线分配的方案完成投放；如果没有优质销售合约，则从自运营广告主库中中找出eCPM较高的，并估算可供调用的若干Network的期望eCPM，在这两者之间找到较高的，以此为低价通过RTBD接口再向接入的各DSP实时询价。可以看出，在这样的逻辑中，广告请求导师是被分配到自运营广告库，还是其他Network，或者是DSP，是根据他们的收益在线动态决定的，这样的方案称为动态分配(Dynamic Allocation)。这样的统一接入各种广告需求以优化媒体广告变现能力的技术，我们称为收益管理(Yield Management)，对应的产品形态，就叫做供给方平台(Supply Side Platform, SSP)。

\begin{figure}\label{fig_dynamic}
\centering
\scalebox{0.6}
{
    \includegraphics[width=1.2\textwidth]{Dynamic.eps}
}
\caption{动态分配决策过程示意}
\end{figure}

SSP中多种广告源动态分配的概要性决策过程如图\ref{fig_dynamic}所示。首先，从自有广告库(Private Ad Base)、联盟广告库(Affiliate Ad Base)中根据当前$(u, c)$上的标签信息检索合适的广告候选，并估计每个广告候选的eCPM；同时，也估计出各个合作的广告网络在当前$(u, c)$情况下大致的eCPM。然后，对所有候选广告和合作广告网络按照eCPM进行统一排序，再以根据排序结果中最高的eCPM做低价调用RTB接口，向各个合作的查询更高变现价值的广告。先进行本地广告检索和eCPM估计，再进行RTB的好处是可以根据当前展示的情况动态调整RTB的低价，而当低价高到一定程度时，即可以略去RTB的过程，从而减轻整个Ad Server 的负担，这样一来，此过程即可以充分利用RTB带来的大量广告主和市场流动性，又充分利用了本地广告库抬高竞价的水平线，从而在提高了收益的同时不至于耗费大量的服务成本。当然，这里介绍的动态分配过程是非常概要和粗略的。在实际的媒体变现中，除了按照eCPM竞价的需求，还需要处理合约广告的保量需求，因此在按eCPM排序之前，还需要有一个对合约广告的在线分配过程，并对那些合约广告不需要的量再进行竞价。

上面的过程里SSP有一个特有的计算问题，这就是其中的网络优化(Network Optimization)问题。这个问题，是对某次展示机会的$(u,c)$，对$N$个候选的Ad Network估计其eCPM以优化收益。相对于CPC计费的Network里的eCPM估计，即点击率预测问题，此问题的挑战主要在于我们$a$维度上只能对Network做粗略的选择，而无法精细地比较各个具体的广告。Network Optimization需要特殊考虑的因素，主要由两个，一个是各候选Network的分成模式和比例；二是各Network的返回率。其中第二个问题是考虑到Network 在接收到广告请求后，由于网络延迟、广告资源等各方面的原因，并不一定能够成功返回广告，而这些也是影响收益的重要因素。关于点击率预测，其框架技术与前面的讨论并无质的区别，我们可是可以用$(u, c)$上的受众定向特征，与现在代表广告网络的$a$上的特征做组合，采用静态和动态特征结合的思路来预测。不过在实际系统中，由于对Network 自己的定向方式和广告库一无所知，使用人群标签可能帮助并不大，反而是使用广告位和时间段这样的基本划分比较稳健。当然，如果接入的Network 中有一些是垂直性的，相应的人群标签就会起作用了。

我们也可以从另外一个有趣的视角来看网络优化。前面我们提到Ad Exchange中的询价优化问题，即估计个DSP可能的出价(由于是CPM竞价，出价即是eCPM)，并选择少量的DSP询价这一过程。考虑极端情况，即只选择一个估计eCPM最高的DSP，那么其计算就变成网络优化问题了。
\subsection{SSP系统架构}
提供较全面收益管理功能的SSP公司，数目并不多，主要有已经被Google收购的Admeld，以及Rubicon和Pubmatic等。我们以Admeld为例说明一下SSP的业务和技术。

\subsubsection{AdMeld}
\subsection{代表案例介绍:Admeld}

\section{数据加工与交易}

要提高定向的精准程度与人群覆盖率，技术并不是最重要的因素。那么什么才是决定性的呢？其实是数据的来源与质量。这是正确认识精准广告业务非常重要的观念。为了进一步强调这一观念，我们以大家更容易理解的石油加工工业为例与作类比：在石油工业中，从油田挖掘出的原油是整个行业的原材料，炼油厂的作用是把这一原材料加工成能直接做燃料用的汽油等商品，再输送给加油站这样的销售终端。在精准广告中，可以把用户的行为类比于石油工业中的原材料，而日志收集和清洗系统的作用就相当于油田的挖掘设备。而受众定向的平台，就可以类比于炼油厂，它把原油，即清洗过的日志，加工成用户标签，而这些用户标签就像汽油一样，是可以被销售和使用的了。而传统广告中起关键作用的广告位，在这里仅仅变成了加油站，负责完成产品消费的过程而已。

那么我们如何正确认识技术在精准广告业务中的作用呢？从上面的类比可以看出，技术的地位相当于挖掘设备和炼油设备，当然有着无可置疑的重要性。技术能力的高低，直接影响着数据采集和变现的有效性。不过从另一个角度说，技术的作用也不能被过分夸大。巧妇难为无米之炊，没有了高质量的原材料，即用户数据，再高明的技术也是没有用武之地的。

既然数据本身有这么根本性的作用，从某种意义上实际上是精准广告市场的核心，那么围绕数据本身的加工与交易，就与广告的投放技术一样令人瞩目。有哪些数据是对精准广告业务有直接贡献的呢，我们可以按照下面的分类来总结：

一、用户标识。对广告而言，如果标定哪些行为来自于同一个用户，是非常关键的问题。不管你能拿到多少访问日志，如果没有办法把它们跟你的投放系统联系起来，这些数据都没有办法发挥作用。对于浏览器行为，我们最常使用的用户标识是cookie，但是由于存在同时使用多个浏览器，cookie过期，或用户主动清除cookie的情况，这种用户标识的长期一致性并不算太好。不过好在对广告来说，起关键作用的还是用户近期内的行为，所以用cookie作用户标识还是有效且为业界广泛采用的基础方案。如果运营广告业务的域名同时提供其他有永久身份的服务，比如email、SNS等，那么可以用这一永久身份找回过期或被清除的cookie，这样用户身份的上一致性就会有所改善。当然，如果广告业务域名和用永久身份服务的域名不同，也不是完全没有办法，在后者同意的前提下，可以采用一种cookie映射的方法来对应彼此的用户身份，这一点的细节我们在后文谈到广告交易平台时再讨论。因此，高质量的用户标识，本身就是一种非常有价值的数据，也是可以在市场交换和售卖的。

二、用户行为。业内通常认为，主要有以下几种类型的在线行为是可以被广泛采集，且对于受众定向或广告决策有明确作用的：转化(transaction)、预转化(pre-transaction)、搜索广告点击(sponsored search click)、显示广告点击(ad click)、搜索点击(search click)、搜索(search)、分享(share)、页面浏览(page view)、广告浏览(ad view)。按照对效果广告的有效性，这些行为可以分为三档：第一档是转化与预转化行为，转化指的是在需求方网站上的具体决策步骤(例如电商的购物行为，游戏的充值等)，预转化指的是以及转化前的一些准备动作，比如浏览、搜索等。这两种行为由于直接明确反映了用户兴趣，因此信息有效性远远高于其余行为。第二档是搜索广告点击、显示广告点击、搜索点击和搜索，这些行为虽然离转化稍远一些，但是也基本属于用户主动行为，有效性也较高。最后一档是分享、页面浏览和广告浏览，这些行为往往都产生于用户在网上无目的浏览时，因此有时不能代表其真正意图，其中分享的有效性好一些，而广告浏览则是与效果负相关的――看得次数越多，效果越差。一般而言，越靠近转化的行为，越主动的行为，对受众定向的指导性越强。

三、人口属性。人口属性本身是常用的一种定向标签，因此其数据来源很重要。一般来说，只有一些能够与用户实名身份绑定的服务可以得到此信息。我们也可以利用网络行为数据来进行人口属性标签的预测，但是这样做的准确程度一般来说很有限，而且这仍然需要一些标定的数据用于训练。对于某些人口属性，可能一些特别的信息比较容易给出准确的判定，比如用语音服务记录的声音信号，可以将男女区分得相当准确。

四、地理位置。地理位置信息随着能获得的精度不同，其用途也会有相当大的差异。如果只能根据IP进行映射，我们往往只能拿到精确到城市级别的地理位置，当然这对于很多广告投放来说，已经有有相当的价值。而在移动互联环境下，GPS或蜂窝可以提供的定位往往可以准确到几百米的范围，这就使得Hyper-local的区域广告商投放定向广告成为可能。这样的广告定向，对于餐饮等受地理位置限制极大的线下业务广告商是非常有价值的。

五、社交关系。社交关系数据的主要意义，在于为用户属性和行为标签提供了平滑的可能性。这一方法的假设是同一个小圈子的用户可能在某些方面有相同的兴趣，因此受众定向可以转化为对这个小圈子共性的挖掘。从这个意义上来看，强关系类型的SNS比弱关系的有优势，关注人群比被关注人群的信息意义更大。

\section{数据管理平台(DMP)}

既然数据的收集和加工是广告市场上非常重要的环节，也就产生了专从事这方面业务的产品，称为数据管理平台(Data Management Platform, DMP)。它的主要功能，是逻辑聚合各种来源的在线的用户行为数据，按照需要方需要的加工成有价值的用户标签，然后在广告市场上使用这些标签来变现。

DMP有几个核心功能。一、它可以为网站(可以是媒体、也可以是广告主网站)提供受众定向功能，并将得到的用户标签应用于网站业务。在这一过程中，除了加工一些通用标签，DMP还需要能够比较灵活地按照网站定义的用户标签来加工受众人群；二、如果媒体网站授权，DMP可以提供接口对加工出来的用户标签进行变现，并与网站进行分成；三、广告主网站可以通过DMP与广告采买渠道进行更方便地数据对接。这一点可以从一个典型的应用来理解：假如某广告主需要通过外部广告平台做重定向(见第7章)，那么需要将自己的用户集合通过某种技术方式通知广告平台。如果每个广告平台都采用在广告主网站上加跟踪代码的方式来收集用户，有两个的弊端，一是多个广告平台同时加代码，有可能使页面变得太重；二是访客的积累需要可能长达数周的时间，这使得广告平台重定向的效率降低。如果由DMP唯一负责广告主网站的用户积累和划分，并通过数据接口的方式传送给广告平台，那么可以极大程度上解决上述问题。

\subsection{DMP案例}

在北美的在线广告市场上，有不少以DMP类似业务为主要方向的公司。在这里我们介绍两家比较有代表性的：一家是Bluekai，一家是AudienceScience。在*图中，后者实际上被划分在“Targeted/Audience”这个板块中，不过由于其主要业务也是面向其它网站的数据加工，因此可以放在DMP板块中加以比较。

\subsubsection{Bluekai}

Bluekai的主要业务模式，是聚合大量中小媒体的有价值行为数据，使用受众定向技术为用户打上标签，并对外售卖标签以获取收入。Bluekai同时提供面向媒体、数据提供商和广告主的一系列产品：包括一个DMP、一个数据交换平台(Bluekai Exchange)、以及一个数据分析系统。这几项产品都围绕一个商业目标展开：那就是帮助有数据变现需求的参与者能够自由、灵活地通过技术对接的方式与广告主进行交易。对于媒体或者其他拥有数据者，可以通过Bluekai Exchange将自己的数据公开式地出售给市场上的需求方，同时可以比较自主地控制定价；对于广告主，可以通过Bluekai提供的DMP产品和第三方数据标签，与自己的第一方数据结合起来，对自己的人群进行更灵活的划分，并按此购买广告。Bluekai通过数据交易获得的收入，其中很大比例还将返还给数据提供方。

通过这种数据交换方式，广告市场上最有价值的数据资源被盘活利用了：数据拥有者不需要直接涉足复杂的广告业务，也可以对数据进行变现；而数据需求者也可以方便地找到数据购买来源，以快速提高自己广告投放的效果。

Bluekai有着比较开放的标签体系，根据广告主使用目的和数据来源的不同，这些标签又分成如下的几种：Intent、B2B、Past Purchases、Geo/Demo、Interest/Lifestyle、Branded、Estimated Financial/Economic。这是一个比较典型的半开放的标签体系，其中的Intent部分，非常类似于前文中的兴趣定向体系，这部分是由Bluekai根据通过Data Exchange收集的用户行为加工的。而其他的部分，有的是由其它数据提供商直接提供，比如由Bizo提供的B2B标签；也有的是根据多家的数据融合决策而成，比如Demo/Geo标签，实际上融合了Bizo、Datalogix、Expedia等多家数据提供商的数据源。

之所以说Bluekai的标签体系是开放式的，是因为它会根据数据的的来源和市场需求不断拓展和调整标签的类别和内容，力求能够满足尽可能多的广告主的特质化需求。Bluekai主要的几种标签、覆盖用户量和主要数据来源，我们列在下表中。
\begin{table}
  \caption{Bluekai标签体系主要类别}
  \begin{center}
    \begin{tabular}{|c|c|c|c|}
      \hline 类别 & 描述 & 数据来源 & 规模(用户数) \\
      \hline Intent             & 最近输入词表现出某种产品或服务需求的用户 & Bluekai Intent & 160+MM\\
      \hline B2B                & 职业上接近某种需求的用户 & Bizo & 12+MM\\
      \hline Past Purchase      & 根据以往消费习惯判断可能购买某产品的用户 & Addthis, Alliant & 65+MM\\
      \hline Geo/Demo           & 地理上或人口属性上接近某标签的用户 & Bizo, Datalogix, Expedia & \\
      \hline Interest/LifeStyle & 可能喜欢某种商品，或某种生活风格的用户 & Forbes, i360, IXI, ... & 103+MM\\
      \hline Estimated Financial& 根据对用户财务状况的估计做的分类 & V12 & \\
      \hline
    \end{tabular}
  \end{center}
  \label{table_exp}
\end{table}

\subsubsection{AudienceScience}

AudienceScience是广告市场上首先明确提出“Audience Targeting”这一概念的公司，并且长期专注于这方面的数据加工和算法建设。

就其数据聚合和收入分成的模式来说，AudienceScience与Bluekai有很多相似之处。两者主要的一个区别，是AudienceScience并不是通过售卖标签来获得收入，而是通过运营一个自有的广告网络来变现。这样做的原因，是AudienceScience认为数据加工业务在扣除媒体分成以后利润空间太小，而自营广告网络有可能获得更大的套利空间。
\section{广告程序交易谱系}
到目前为止，我们已经接触到了在线广告市场上大多数常见的交易方式，有必要对它们做一个系统的总结。按时间段和广告位独占式的售卖，以及GD这种合约式的售卖，是销售与客户之间将广告投放的关键方面约定下来的交易方式，在其中人的因素起了相当大的作用，不过这种售卖一般来说由于能满足一些品牌性需求，溢价能力也比较好，在高质量的媒体上属于优先考虑的售卖方式，我们把它们称为优质售卖(Premium Sales)。从技术层面来说，优先售卖整体对计算的要求不算特别深入，而且主要的技术集中在供给方(比如在线分配、受众定向)。在Ad Network和Ad Exchange产生以后，广告交易的一些细节越来越多地依赖在线计算而非事先约定，对需求方和供给方而言，也都产生了一些新的程序交易(Programmatic Trade)方式。

\begin{figure} \centering
    \setlength{\unitlength}{0.8mm}
    \begin{picture}(150,50)
    \thicklines
    \put(50, 45){程序交易}
    \put(41, 41){(Programmatic Trade)}
    \drawline(20, 35)(150, 35)
    \drawline(100, 0)(100, 50)
    \drawline(100, 0)(100, 50)
    \put(0, 5){需求方}  \put(25, 5){RTBS}  \put(50, 7){Preferred} \put(50, 3){Match}  \put(75, 7){Portfolio} \put(75, 3){Selection}
    \put(0, 15){中间平台} \put(25, 15){Ad Exchange}  \put(75, 15){Ad Network}
    \put(0, 25){供给方} \put(25, 25){RTBD} \put(50, 27){Preferred} \put(50, 23){Match}  \put(75, 27){Network} \put(75, 23){Optimization}

    \put(115, 45){优质售卖}
    \put(111, 41){(Premium Sales)}
    \put(104, 15){Ad Server}
    \put(104, 27){Guaranteed} \put(104, 23){Delivery}
    \put(135, 25){CPT}
    \end{picture}
\caption{在线广告主要交易方式一览}
\label{fig_program}
\end{figure}

当竞价广告产生以后，对供给方而言，可以通过将广告位直接托管给Ad Network的方式变现，也可以同时使用给多个广告联盟，按照一些准则或计算接过来灵活地对不同的流量分割选择不同的Ad Network，这是供给方利用Ad Network变现的一种程序交易方式，称为网络优化(Network Optimization)，我们在下文中的供给方平台中还会讨论。对需求方而言，则存在选择合适的人群标签并合理出价，以优化整体ROI的程序交易要求。在实时竞价的环境中，程序交易的过程变得更加简单直接，供应方的RTBD接口和需求方的RTBS接口通过Ad Exchange直接对接，并完成精细的流量采买。除了这两种市场上常见的程序交易结构，还有一种称为优选匹配(Preferred Match)的交易机制，也属于程序交易的范畴，这种交易方式是需求方与供给方约定一个CPM采购价格(一般来说该价格高于市场平均水平)，但是并不一定完全接受供给方发送过来的流量，对于其不需要的部分，再发回给供给方投放其他优先级更低的广告。这种方式是供给方与需求方之间直接发生的程序交易，但是扩展性不强，不适合于大量广告主同时接入的方式。正如其名字表示的那样，优选方式主要适合于媒体将剩余流量以较高的溢价售卖给特别精准的高价值需求方，比如Criteo那样的个性化重定向平台。我们在图\ref{fig_program}中列出了包括优质售卖和程序交易等各种在线广告主要的交易方式，希望对大家从技术角度全面理解市场结构有所帮助。

\begin{figure}\label{fig_market}
\centering
\scalebox{0.6}
{
    \includegraphics[width=1\textwidth]{market.eps}
}
\caption{在线广告市场产品交互关系示意}
\end{figure}

上面谈的是各种在线广告的交易方式，在实际的广告市场中，这些交易方式又是怎样通过具体的产品联系起来的呢？我们在图\ref{fig_market}中示意性地表示了在线广告市场各种产品的配合关系。从媒体(Publisher)角度看，有三种产品可以帮助其变现流量：一、可以将广告位托管给广告网络，由广告网络决策广告投放，从赚取分成，如图中的“Publisher 1”；二、可以将广告位对接到广告交易平台，以实时竞价的方式变现，如图中的“Publisher 2”；三、也可以将广告位托管给SSP，这样可以同时对接多个广告网络和实时竞价接口，并按照动态分配的逻辑选择变现最高的需求方(这一产品的具体情况我们在下一节中介绍)，如图中的“Publisher 3”。
\clearpage{\pagestyle{empty}} %\cleardoublepage

\end{CJK*}
